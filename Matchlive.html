<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</title>
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
:root{
  --bg:#0b0b0b; --panel:#111; --muted:#9aa0a6; --accent:#e50914;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:'Roboto',sans-serif;
  background:var(--bg);
  color:#fff;
}
header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 20px;
  background:linear-gradient(90deg,#0f0f0f,#141414);
  border-bottom:1px solid #1b1b1b;
}
header h1{margin:0;font-weight:500;font-size:18px;}
header .actions{display:flex;gap:12px;align-items:center;}
button.btn{
  background:var(--accent);
  border:0;padding:8px 14px;border-radius:8px;color:#fff;cursor:pointer;
}
button.ghost{
  background:transparent;border:1px solid #222;padding:8px 14px;border-radius:8px;color:#ccc;cursor:pointer;
}
.main{
  display:flex;gap:16px;padding:16px;height:calc(100vh - 64px);
}
.left{
  flex:1;
  display:flex;
  flex-direction:column;
  gap:12px;
  overflow:auto;
}
.left input[type="text"]{
  padding:8px;
  border-radius:6px;
  border:1px solid #222;
  background:#080808;
  color:#fff;
  margin-bottom:10px;
}
.channels{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
  gap:12px;
}
.card{
  background:var(--panel);
  border-radius:10px;
  overflow:hidden;
  cursor:pointer;
  transition:0.2s;
  display:flex;
  flex-direction:column;
  border:1px solid #1b1b1b;
}
.card:hover{transform:translateY(-3px);border-color:var(--accent);}
.card img{width:100%;height:100px;object-fit:cover;}
.card .title{
  font-size:14px;
  font-weight:500;
  padding:4px 6px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
.card .actions{
  display:flex;justify-content:space-between;padding:4px 6px;gap:4px;
}
.right{
  width:520px;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.playerBox{
  background:var(--panel);
  padding:12px;
  border-radius:10px;
  border:1px solid #1b1b1b;
}
video{
  width:100%;
  height:300px;
  border-radius:10px;
  background:#000;
}
.form{
  background:var(--panel);
  padding:12px;
  border-radius:10px;
  border:1px solid #1b1b1b;
  display:none;
  flex-direction:column;
  gap:8px;
}
input[type="url"],input[type="text"]{
  width:100%;
  padding:8px;
  border-radius:6px;
  border:1px solid #222;
  background:#080808;
  color:#fff;
}
.filePreview{
  width:110px;height:65px;background:#000;border:1px dashed #333;border-radius:6px;
  display:flex;align-items:center;justify-content:center;color:#777;font-size:13px;
}
@media(max-width:950px){
  .main{flex-direction:column}
  .right{width:100%}
  video{height:240px}
}
</style>
</head>
<body>

<header>
  <h1>Ù…Ø´ØºÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</h1>
  <div class="actions">
    <input type="text" id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù‚Ù†Ø§Ø©...">
    <button class="btn" id="openFormBtn">â• Ø¥Ø¶Ø§ÙØ© Ù‚Ù†Ø§Ø©</button>
  </div>
</header>

<div class="main">

  <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù‚Ù†ÙˆØ§Øª -->
  <div class="left">
    <div class="channels" id="channelList"></div>
  </div>

  <!-- Ø§Ù„Ù…Ø´ØºÙ„ + Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ -->
  <div class="right">
    <div class="playerBox">
      <video id="video" controls muted></video>
      <div id="status" style="color:#aaa;margin-top:6px">Ø¬Ø§Ù‡Ø²</div>
      <div style="margin-top:6px;color:#9ee1a8" id="manifestLink"></div>
      <button class="ghost" id="stopBtn">Ø¥ÙŠÙ‚Ø§Ù</button>
    </div>

    <div class="form" id="addForm">
      <input type="text" id="chName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ù†Ø§Ø©">
      <input type="url" id="chUrl" placeholder="Ø±Ø§Ø¨Ø· m3u8 Ø£Ùˆ ts">
      <input type="file" id="chImage" accept="image/*">
      <div id="preview" class="filePreview">ØµÙˆØ±Ø©</div>
      <div style="display:flex;gap:6px">
        <button class="btn" id="addBtn">Ø¥Ø¶Ø§ÙØ©</button>
        <button class="ghost" id="cancelBtn">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
      <div id="formMsg" style="color:#ccc"></div>
    </div>
  </div>
</div>

<script>
let CHANNELS = [];

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ù† localStorage */
const saved = localStorage.getItem("channelsDB");
if(saved){
  CHANNELS = JSON.parse(saved);
}else{
  CHANNELS = [
    {name:"ChaÃ®ne Sport",url:"https://koraflix.s-cloudflare.com/live/250_.m3u8",image:"https://i.imgur.com/TVgZC1y.jpeg"}
  ];
}

/* DOM Elements */
const channelList = document.getElementById("channelList");
const video = document.getElementById("video");
const statusEl = document.getElementById("status");
const manifestLink = document.getElementById("manifestLink");
const openFormBtn = document.getElementById("openFormBtn");
const addForm = document.getElementById("addForm");
const cancelBtn = document.getElementById("cancelBtn");
const addBtn = document.getElementById("addBtn");
const chName = document.getElementById("chName");
const chUrl = document.getElementById("chUrl");
const chImage = document.getElementById("chImage");
const preview = document.getElementById("preview");
const formMsg = document.getElementById("formMsg");
const stopBtn = document.getElementById("stopBtn");
const searchInput = document.getElementById("searchInput");

let hls = null;
let lastThumbData = null;

/* ================= Render Channels ================= */
function renderChannels(filter=""){
  channelList.innerHTML = "";
  CHANNELS.forEach((ch,i)=>{
    if(filter && !ch.name.toLowerCase().includes(filter.toLowerCase())) return;
    const card = document.createElement("div");
    card.className="card";
    card.innerHTML=`
      <img src="${ch.image}">
      <div class="title">${ch.name}</div>
      <div class="actions">
        <button class="ghost" onclick="editChannel(${i},event)">âœï¸</button>
        <button class="ghost" onclick="deleteChannel(${i},event)">ğŸ—‘ï¸</button>
      </div>
    `;
    card.onclick = ()=>playChannel(i);
    channelList.appendChild(card);
  });
}

/* ================= Play Channel ================= */
function playChannel(i){
  const ch = CHANNELS[i];
  manifestLink.innerHTML = ch.url;
  if(hls){ hls.destroy(); hls=null; }
  video.pause();
  if(Hls.isSupported() && ch.url.endsWith(".m3u8")){
    hls = new Hls();
    hls.loadSource(ch.url);
    hls.attachMedia(video);
    hls.on(Hls.Events.MANIFEST_PARSED, ()=> video.play());
  }else{
    video.src = ch.url;
    video.play();
  }
  statusEl.textContent="Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„Ø¢Ù†";
}

/* ================= Add / Edit / Delete ================= */
openFormBtn.onclick=()=>{addForm.style.display="flex";};
cancelBtn.onclick=()=>{addForm.style.display="none"; resetForm();};

function resetForm(){
  chName.value=""; chUrl.value=""; chImage.value="";
  preview.innerHTML="ØµÙˆØ±Ø©"; lastThumbData=null; formMsg.textContent="";
}

chImage.onchange=()=>{
  const f=chImage.files[0];
  if(!f){ preview.innerHTML="ØµÙˆØ±Ø©"; return; }
  const r=new FileReader();
  r.onload=e=>{
    lastThumbData=e.target.result;
    preview.innerHTML=`<img src="${lastThumbData}" style="width:100%;height:100%;object-fit:cover">`;
  };
  r.readAsDataURL(f);
};

addBtn.onclick=()=>{
  const name=chName.value.trim();
  const url=chUrl.value.trim();
  if(!name||!url){ formMsg.textContent="Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; return; }

  if(addBtn.dataset.editIndex){
    // ØªØ¹Ø¯ÙŠÙ„
    const idx=parseInt(addBtn.dataset.editIndex);
    CHANNELS[idx]={name,url,image:lastThumbData||CHANNELS[idx].image};
    delete addBtn.dataset.editIndex;
    formMsg.textContent="ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©";
  }else{
    // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
    CHANNELS.unshift({name,url,image:lastThumbData||"https://via.placeholder.com/160x90?text=Channel"});
    formMsg.textContent="ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  }
  localStorage.setItem("channelsDB",JSON.stringify(CHANNELS));
  renderChannels(searchInput.value);
  addForm.style.display="none"; resetForm();
};

window.deleteChannel=(i,e)=>{
  e.stopPropagation();
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù‚Ù†Ø§Ø©ØŸ")){
    CHANNELS.splice(i,1);
    localStorage.setItem("channelsDB",JSON.stringify(CHANNELS));
    renderChannels(searchInput.value);
  }
};

window.editChannel=(i,e)=>{
  e.stopPropagation();
  const ch=CHANNELS[i];
  addForm.style.display="flex";
  chName.value=ch.name;
  chUrl.value=ch.url;
  preview.innerHTML=`<img src="${ch.image}" style="width:100%;height:100%;object-fit:cover">`;
  lastThumbData=ch.image;
  addBtn.dataset.editIndex=i;
};

/* ================= Stop ================= */
stopBtn.onclick=()=>{
  if(hls){ hls.destroy(); hls=null; }
  video.pause(); video.src="";
  statusEl.textContent="Ù…ØªÙˆÙ‚Ù";
};

/* ================= Search ================= */
searchInput.oninput=()=>{ renderChannels(searchInput.value); };

/* ================= Init ================= */
renderChannels();
</script>
</body>
</html>