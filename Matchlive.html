<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TV Player — m3u8</title>

<!-- HLS.js -->
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<style>
  :root{
    --bg:#0b0b0b;
    --card:#111;
    --accent:#e50914;
    --muted:#bdbdbd;
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    background:var(--bg);
    color:#fff;
    font-family:system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
    display:flex;
    min-height:100vh;
    align-items:center;
    justify-content:center;
    padding:18px;
  }

  .app{
    width:100%;
    max-width:980px;
  }

  header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
    margin-bottom:14px;
  }
  .brand{
    font-weight:700;
    letter-spacing:1px;
    font-size:20px;
    color:var(--accent);
  }
  .info {color:var(--muted); font-size:14px}

  .player-card{
    background:linear-gradient(180deg,#0f0f0f,#090909);
    border-radius:12px;
    overflow:hidden;
    box-shadow:0 10px 30px rgba(0,0,0,0.6);
  }

  .video-wrap{
    position:relative;
    background:#000;
  }
  video{
    width:100%;
    height:auto;
    display:block;
    background:black;
  }

  .controls-row{
    display:flex;
    gap:8px;
    align-items:center;
    padding:10px;
  }

  .channels{
    display:flex;
    gap:8px;
    padding:10px;
    overflow-x:auto;
    background:rgba(255,255,255,0.02);
  }
  .channel-btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    padding:8px 12px;
    border-radius:8px;
    color:#fff;
    cursor:pointer;
    white-space:nowrap;
    font-size:14px;
  }
  .channel-btn.active{
    background:var(--accent);
    color:#fff;
    border-color:transparent;
  }

  .meta{
    padding:12px;
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }

  .small{
    font-size:13px;
    color:var(--muted);
  }

  .btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:#fff;
    padding:8px 10px;
    border-radius:8px;
    cursor:pointer;
  }

  @media (max-width:600px){
    .brand{font-size:16px}
    .info{display:none}
  }
</style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="brand">Adel TV</div>
        <div class="info">مباشر — قنوات m3u8</div>
      </div>
      <div class="info">جهاز التشغيل: HTML5 + hls.js</div>
    </header>

    <div class="player-card">
      <div class="video-wrap">
        <!-- اللاعب -->
        <video id="player" controls playsinline webkit-playsinline></video>
      </div>

      <div class="meta">
        <div>
          <div id="title" style="font-weight:700">BEIN 1</div>
          <div class="small" id="status">جاهز</div>
        </div>

        <div style="display:flex;gap:8px;align-items:center">
          <button class="btn" id="btnReload">إعادة تحميل</button>
          <button class="btn" id="btnCopy">نسخ رابط البث</button>
          <button class="btn" id="btnPIP">Picture-in-Picture</button>
        </div>
      </div>

      <div class="channels" id="channels">
        <!-- أضف قنوات هنا - أزرار لتبديل الروابط -->
        <button class="channel-btn active" data-src="https://ab.footballii.ir/hls2/bein1_src.m3u8">BEIN 1</button>
        <button class="channel-btn" data-src="https://koraflix.s-cloudflare.com/live/250_.m3u8">Channel 2</button>
        <!-- تقدر تضيف أزرار بقنوات أخرى -->
      </div>
    </div>
  </div>

<script>
(function(){
  // الرابط الرئيسي الذي أعطيتَه
  const defaultURL = "https://ab.footballii.ir/hls2/bein1_src.m3u8";

  const video = document.getElementById('player');
  const status = document.getElementById('status');
  const titleEl = document.getElementById('title');
  const btnReload = document.getElementById('btnReload');
  const btnCopy = document.getElementById('btnCopy');
  const btnPIP = document.getElementById('btnPIP');
  const channels = document.getElementById('channels');

  let hls = null;

  // دالة لتهيئة المصدر
  function loadStream(url){
    // تنظيف أي instance سابقة
    if(hls){
      hls.destroy();
      hls = null;
    }

    status.textContent = "جاري الاتصال...";
    // إذا المتصفح يدعم HLS بشكل أصلي (Safari)
    if(video.canPlayType('application/vnd.apple.mpegURL')){
      video.src = url;
      video.play().catch(()=>{ /* autoplay blocked */ });
      status.textContent = "مشغّل (native)";
    } else if (Hls.isSupported()) {
      hls = new Hls({
        maxBufferLength: 30,
        // يمكنك تعديل الإعدادات هنا
      });
      hls.loadSource(url);
      hls.attachMedia(video);

      hls.on(Hls.Events.MANIFEST_PARSED, function() {
        status.textContent = "متصل — جاهز للبث";
        video.play().catch(()=>{ /* autoplay blocked */ });
      });

      hls.on(Hls.Events.ERROR, function(event, data) {
        console.error("HLS error", event, data);
        status.textContent = "خطأ في البث: " + (data && data.type ? data.type : "غير معروف");
        // محاولة إعادة التحميل تلقائياً عند الخطأ الفادح
        if(data && data.fatal){
          hls.destroy();
          hls = null;
          setTimeout(()=> loadStream(url), 3000);
        }
      });
    } else {
      status.textContent = "المتصفح لا يدعم HLS ولا hls.js.";
    }
  }

  // تحميل المبدئي
  loadStream(defaultURL);

  // التعامل مع أزرار القنوات
  channels.addEventListener('click', e=>{
    const btn = e.target.closest('.channel-btn');
    if(!btn) return;
    // تفعيل التنسيق البصري
    document.querySelectorAll('.channel-btn').forEach(x=>x.classList.remove('active'));
    btn.classList.add('active');

    const src = btn.dataset.src;
    titleEl.textContent = btn.textContent || 'Live';
    loadStream(src);
  });

  // إعادة تحميل
  btnReload.addEventListener('click', ()=>{
    const active = document.querySelector('.channel-btn.active');
    if(active){
      loadStream(active.dataset.src);
    }
  });

  // نسخ رابط البث
  btnCopy.addEventListener('click', async ()=>{
    const active = document.querySelector('.channel-btn.active');
    if(!active) return;
    try{
      await navigator.clipboard.writeText(active.dataset.src);
      btnCopy.textContent = "تم النسخ ✓";
      setTimeout(()=> btnCopy.textContent = "نسخ رابط البث", 1400);
    }catch(err){
      console.warn(err);
      alert("النسخ لم ينجح — انسخ يدويا:\n" + active.dataset.src);
    }
  });

  // Picture-in-Picture (إن وُجد)
  btnPIP.addEventListener('click', async ()=>{
    if (!document.pictureInPictureEnabled) {
      alert("Picture-in-Picture غير مدعوم في متصفحك.");
      return;
    }
    try{
      if (document.pictureInPictureElement) {
        await document.exitPictureInPicture();
      } else {
        await video.requestPictureInPicture();
      }
    }catch(err){
      console.error(err);
      alert("فشل تشغيل PIP.");
    }
  });

  // وضع رسالة عند انتهاء الفيديو أو فشل التشغيل
  video.addEventListener('error', ()=>{
    status.textContent = "فشل تشغيل الفيديو. تأكد من الرابط.";
  });

})();
</script>
</body>
</html>
