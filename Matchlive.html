<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Adel Tv â€” Lecteur</title>
  <style>
    :root{--bg:#071022;--card:#0b1220;--accent:#06b6d4;--muted:#9aa6b2}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial,sans-serif;background:var(--bg);color:#e6eef6}
    .container{max-width:1100px;margin:24px auto;padding:16px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
    .logo{width:44px;height:44px;border-radius:8px;background:var(--accent);display:flex;align-items:center;justify-content:center;font-weight:700;color:#052026}
    h1{font-size:18px;margin:0}
    .player{background:rgba(255,255,255,0.02);border-radius:10px;overflow:hidden;box-shadow:0 10px 30px rgba(2,6,23,0.6)}
    iframe{width:100%;height:620px;border:0;background:#000;display:block}
    .controls{display:flex;justify-content:space-between;align-items:center;padding:10px 12px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(0,0,0,0.02));gap:8px}
    button{background:var(--accent);border:0;padding:8px 12px;border-radius:8px;color:#052026;font-weight:600;cursor:pointer}
    .muted{color:var(--muted);font-size:13px}
    @media (max-width:640px){ iframe{height:360px} }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">A</div>
      <div>
        <h1>Adel Tv</h1>
        <div class="muted"> Adel movies ðŸ”¥</div>
      </div>
    </header>

    <div class="player" id="playerWrap">
      <!-- iframe corrigÃ© (frameborder au lieu de rameborder) -->
      <iframe
        id="streamFrame"
        src="https://pl.yalashoot.xyz/albaplayer/kuwait-sport/?serv=0"
        allow="autoplay; encrypted-media"
        allowfullscreen
        frameborder="0"
      ></iframe>

      <div class="controls">
        <div class="muted">Source: Adel TV</div>
        <div style="display:flex;gap:8px">
          <button id="openFullscreen">Plein Ã©cran</button>
          <button id="reload">Recharger</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    const iframe = document.getElementById('streamFrame');
    const wrap = document.getElementById('playerWrap');

    document.getElementById('reload').addEventListener('click', () => {
      // ajoute un timestamp pour forcer le rechargement
      const url = new URL(iframe.src);
      url.searchParams.set('_r', Date.now());
      iframe.src = url.toString();
    });

    document.getElementById('openFullscreen').addEventListener('click', () => {
      if (wrap.requestFullscreen) wrap.requestFullscreen();
      else if (wrap.webkitRequestFullscreen) wrap.webkitRequestFullscreen();
      else if (wrap.msRequestFullscreen) wrap.msRequestFullscreen();
      else alert('Votre navigateur ne supporte pas le plein Ã©cran via script â€” utilisez le bouton du lecteur.');
    });
  </script>
</body>
</html>  
</style>
</head>
<body>



<script>
let CHANNELS = [];

/* ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù‚Ù†ÙˆØ§Øª Ù…Ù† localStorage */
const saved = localStorage.getItem("channelsDB");
if(saved){
  CHANNELS = JSON.parse(saved);
}else{
  CHANNELS = [
    {name:"ChaÃ®ne Sport",url:"https://koraflix.s-cloudflare.com/live/250_.m3u8",image:"https://i.imgur.com/TVgZC1y.jpeg"}
  ];
}

/* DOM Elements */
const channelList = document.getElementById("channelList");
const video = document.getElementById("video");
const statusEl = document.getElementById("status");
const manifestLink = document.getElementById("manifestLink");
const openFormBtn = document.getElementById("openFormBtn");
const addForm = document.getElementById("addForm");
const cancelBtn = document.getElementById("cancelBtn");
const addBtn = document.getElementById("addBtn");
const chName = document.getElementById("chName");
const chUrl = document.getElementById("chUrl");
const chImage = document.getElementById("chImage");
const preview = document.getElementById("preview");
const formMsg = document.getElementById("formMsg");
const stopBtn = document.getElementById("stopBtn");
const searchInput = document.getElementById("searchInput");

let hls = null;
let lastThumbData = null;


cancelBtn.onclick=()=>{addForm.style.display="none"; resetForm();};

function resetForm(){
  chName.value=""; chUrl.value=""; chImage.value="";
  preview.innerHTML="ØµÙˆØ±Ø©"; lastThumbData=null; formMsg.textContent="";
}

chImage.onchange=()=>{
  const f=chImage.files[0];
  if(!f){ preview.innerHTML="ØµÙˆØ±Ø©"; return; }
  const r=new FileReader();
  r.onload=e=>{
    lastThumbData=e.target.result;
    preview.innerHTML=`<img src="${lastThumbData}" style="width:100%;height:100%;object-fit:cover">`;
  };
  r.readAsDataURL(f);
};

addBtn.onclick=()=>{
  const name=chName.value.trim();
  const url=chUrl.value.trim();
  if(!name||!url){ formMsg.textContent="Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"; return; }

  if(addBtn.dataset.editIndex){
    // ØªØ¹Ø¯ÙŠÙ„
    const idx=parseInt(addBtn.dataset.editIndex);
    CHANNELS[idx]={name,url,image:lastThumbData||CHANNELS[idx].image};
    delete addBtn.dataset.editIndex;
    formMsg.textContent="ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù‚Ù†Ø§Ø©";
  }else{
    // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
    CHANNELS.unshift({name,url,image:lastThumbData||"https://via.placeholder.com/160x90?text=Channel"});
    formMsg.textContent="ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ©";
  }
  localStorage.setItem("channelsDB",JSON.stringify(CHANNELS));
  renderChannels(searchInput.value);
  addForm.style.display="none"; resetForm();
};

window.deleteChannel=(i,e)=>{
  e.stopPropagation();
  if(confirm("Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù‚Ù†Ø§Ø©ØŸ")){
    CHANNELS.splice(i,1);
    localStorage.setItem("channelsDB",JSON.stringify(CHANNELS));
    renderChannels(searchInput.value);
  }
};

window.editChannel=(i,e)=>{
  e.stopPropagation();
  const ch=CHANNELS[i];
  addForm.style.display="flex";
  chName.value=ch.name;
  chUrl.value=ch.url;
  preview.innerHTML=`<img src="${ch.image}" style="width:100%;height:100%;object-fit:cover">`;
  lastThumbData=ch.image;
  addBtn.dataset.editIndex=i;
};

/* ================= Stop ================= */
stopBtn.onclick=()=>{
  if(hls){ hls.destroy(); hls=null; }
  video.pause(); video.src="";
  statusEl.textContent="Ù…ØªÙˆÙ‚Ù";
};

/* ================= Search ================= */
searchInput.oninput=()=>{ renderChannels(searchInput.value); };

/* ================= Init ================= */
renderChannels();
</script>
</body>
</html>
